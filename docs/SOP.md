# ğŸ“‹ æ™ºæ…§ç©ºé–“å¹³å° - æ¨™æº–ä½œæ¥­ç¨‹åº (SOP)

## ğŸ“– æ–‡æª”æ¦‚è¿°
**æ–‡æª”åç¨±**: æ¨™æº–ä½œæ¥­ç¨‹åº (Standard Operating Procedures)
**é©ç”¨å°ˆæ¡ˆ**: æ™ºæ…§ç©ºé–“å¹³å° (Intelligent Spatial Platform)
**æŠ€è¡“æ£§**: Go + CesiumJS + PostgreSQL + Ollama + WebSocket
**æ–‡æª”ç‰ˆæœ¬**: v1.0

## ğŸ¯ SOP ç›®çš„
- æ¨™æº–åŒ–å°ˆæ¡ˆç®¡ç†æµç¨‹ï¼Œç¢ºä¿ä¸€è‡´æ€§å’Œå“è³ª
- æä¾›æ¸…æ¥šçš„æ“ä½œæŒ‡å¼•ï¼Œæ¸›å°‘éŒ¯èª¤å’Œéºæ¼
- æ”¯æ´åœ˜éšŠæˆå“¡å¿«é€Ÿä¸Šæ‰‹
- æŒçºŒæ”¹é€²å°ˆæ¡ˆç®¡ç†æ•ˆç‡

---

## ğŸ“‹ SOP-001: è¨ˆç•«å»ºç«‹æ¨™æº–ç¨‹åº (5åˆ†é˜)

### æ­¥é©Ÿ 1: ç²å–æ™‚é–“æˆ³
```bash
# ç²å–ç•¶å‰æ™‚é–“æˆ³ (æ ¼å¼: YYYYMMDD_HHMMSS)
date +"%Y%m%d_%H%M%S"
```

### æ­¥é©Ÿ 2: é¸æ“‡æ­£ç¢ºæ¨¡æ¿
- **æŠ€è¡“å¯¦ä½œè¨ˆç•«**: ä½¿ç”¨ `templates/PLAN_TEMPLATE.md`
- **åˆ†æå ±å‘Š**: ä½¿ç”¨ `templates/ANALYSIS_TEMPLATE.md`

### æ­¥é©Ÿ 3: å»ºç«‹è¨ˆç•«æª”æ¡ˆ
```bash
# è¤‡è£½æ¨¡æ¿ä¸¦é‡æ–°å‘½å
cp docs/templates/PLAN_TEMPLATE.md "docs/plans/active/YYYYMMDD_HHMMSS_Plan_Name.md"
```

### æ­¥é©Ÿ 4: å¡«å¯«æ ¸å¿ƒå…§å®¹ (å¿…å¡«é …ç›®)
1. **è¨ˆç•«ID** å’Œ **è¨ˆç•«åç¨±**
2. **å„ªå…ˆç´š** (ğŸ”´é«˜/ğŸŸ¡ä¸­/ğŸŸ¢ä½)
3. **é è¨ˆå®Œæˆæ—¥æœŸ**
4. **å•é¡Œå®šç¾©èˆ‡ç›®æ¨™** (æ ¸å¿ƒé‡é»)
5. **å¯¦ä½œéšæ®µè¦åŠƒ** (å…·é«”å¯åŸ·è¡Œ)

### æ­¥é©Ÿ 5: å“è³ªæª¢æŸ¥èˆ‡ç´¢å¼•æ›´æ–°
- [ ] æª¢æŸ¥æª”æ¡ˆå‘½åæ ¼å¼æ­£ç¢º
- [ ] æ ¸å¿ƒå…§å®¹å·²å¡«å¯«å®Œæ•´
- [ ] æª”æ¡ˆå·²å­˜æ”¾åˆ° `plans/active/` ç›®éŒ„
- [ ] å·²æ›´æ–° `PROJECT_INDEX.md` ç´¢å¼•

---

## ğŸ“‹ SOP-002: ç‹€æ…‹ç®¡ç†ç¨‹åº

### ç”Ÿå‘½é€±æœŸ
```
ğŸŸ¢ ACTIVE â†’ âœ… COMPLETED â†’ (30å¤©å¾Œ) â†’ ğŸ“¦ ARCHIVED
         â†˜ âŒ CANCELLED
```

### ç‹€æ…‹è®Šæ›´æ“ä½œ
1. æ›´æ–°è¨ˆç•«æ–‡æª”ç‹€æ…‹
2. ç§»å‹•æª”æ¡ˆåˆ°å°æ‡‰ç›®éŒ„
3. æ›´æ–° PROJECT_INDEX.md
4. è¨˜éŒ„è®Šæ›´åŸå› å’Œæ—¥æœŸ

### å¸¸è¦‹ç‹€æ…‹è®Šæ›´ç¯„ä¾‹
```bash
# å®Œæˆè¨ˆç•«
mv docs/plans/active/20250914_143000_Feature_Development.md docs/plans/completed/

# å–æ¶ˆè¨ˆç•«
mv docs/plans/active/20250914_144500_Deprecated_Feature.md docs/plans/cancelled/

# æ­¸æª”èˆŠè¨ˆç•«
mv docs/plans/completed/20250814_* docs/plans/archived/
```

---

## ğŸ“‹ SOP-003: æ™ºæ…§ç©ºé–“å¹³å°å°ˆæ¡ˆç‰¹æ®Šç¨‹åº

### é–‹ç™¼ç’°å¢ƒå•Ÿå‹•
```bash
# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
./scripts/dev-setup.sh

# æª¢æŸ¥æœå‹™ç‹€æ…‹
podman-compose ps

# è¨ªå•æ‡‰ç”¨ç¨‹å¼
open http://localhost:3000
```

### ç¨‹å¼ç¢¼æäº¤å‰æª¢æŸ¥
```bash
# æ ¼å¼åŒ– Go ç¨‹å¼ç¢¼
go fmt ./...

# åŸ·è¡Œæ¸¬è©¦
go test ./...

# å»ºæ§‹æª¢æŸ¥
go build cmd/server/main.go

# å‰ç«¯æª¢æŸ¥ (å¦‚æœæœ‰ä¿®æ”¹)
cd web && npm run lint
```

### API é–‹ç™¼æµç¨‹
1. åœ¨ `internal/api/` æ–°å¢è·¯ç”±è™•ç†å™¨
2. æ›´æ–° API æ–‡æª” (README.md API ç« ç¯€)
3. æ’°å¯«å–®å…ƒæ¸¬è©¦
4. æ¸¬è©¦ WebSocket æ•´åˆ

### 3D åœ°åœ–åŠŸèƒ½é–‹ç™¼
1. ç¢ºèª CesiumJS ç‰ˆæœ¬ç›¸å®¹æ€§
2. æ¸¬è©¦ CESIUM_ACCESS_TOKEN æœ‰æ•ˆæ€§
3. é©—è­‰åœ°ç†è³‡æ–™æ ¼å¼
4. æª¢æŸ¥ PostGIS ç©ºé–“æŸ¥è©¢åŠŸèƒ½

### AI åŠŸèƒ½é–‹ç™¼
1. ç¢ºèª Ollama æœå‹™é‹è¡Œ
2. æ¸¬è©¦æ¨¡å‹è¼‰å…¥ç‹€æ…‹
3. é©—è­‰ä¸­æ–‡å°è©±å“è³ª
4. æª¢æŸ¥èªéŸ³æ•´åˆåŠŸèƒ½

---

## ğŸ“‹ SOP-004: å“è³ªæª¢æŸ¥æ¸…å–®

### å»ºç«‹è¨ˆç•«æª¢æŸ¥æ¸…å–®
- [ ] **æ™‚é–“æˆ³æ ¼å¼**: YYYYMMDD_HHMMSS æ ¼å¼æ­£ç¢º
- [ ] **æª”æ¡ˆå‘½å**: ä½¿ç”¨è‹±æ–‡ï¼Œé¿å…ç‰¹æ®Šå­—ç¬¦
- [ ] **å¿…å¡«æ¬„ä½**: è¨ˆç•«IDã€åç¨±ã€å„ªå…ˆç´šå·²å¡«å¯«
- [ ] **ç›®æ¨™æ˜ç¢º**: å•é¡Œå®šç¾©å’Œè§£æ±ºç›®æ¨™æ¸…æ¥š
- [ ] **å¯åŸ·è¡Œæ€§**: å¯¦ä½œéšæ®µå…·é«”å¯æ“ä½œ
- [ ] **ç´¢å¼•æ›´æ–°**: PROJECT_INDEX.md å·²åŒæ­¥æ›´æ–°

### æ™ºæ…§ç©ºé–“å¹³å°ç‰¹æ®Šæª¢æŸ¥
- [ ] **æŠ€è¡“ç›¸å®¹æ€§**: èˆ‡ç¾æœ‰ Go/CesiumJS æ¶æ§‹ç›¸å®¹
- [ ] **å®¹å™¨æ•´åˆ**: ç¢ºèª Podman å®¹å™¨é…ç½®æ­£ç¢º
- [ ] **API ä¸€è‡´æ€§**: ç¬¦åˆ RESTful è¨­è¨ˆåŸå‰‡
- [ ] **WebSocket æ”¯æ´**: å³æ™‚é€šè¨ŠåŠŸèƒ½æ­£å¸¸
- [ ] **åœ°ç†è³‡æ–™**: PostGIS æŸ¥è©¢æ•ˆèƒ½è‰¯å¥½
- [ ] **AI æ•´åˆ**: Ollama æœå‹™æ•´åˆç„¡èª¤

---

## ğŸ“‹ SOP-005: ç·Šæ€¥æ‡‰è®Šç¨‹åº

### ç³»çµ±æ•…éšœè™•ç†
1. **æª¢æŸ¥æœå‹™ç‹€æ…‹**
```bash
# å¿«é€Ÿè¨ºæ–·
curl http://localhost:3000/health
podman-compose ps
```

2. **æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ**
```bash
# æ‡‰ç”¨ç¨‹å¼æ—¥èªŒ
podman-compose logs -f app

# è³‡æ–™åº«æ—¥èªŒ
podman-compose logs -f postgres

# AI æœå‹™æ—¥èªŒ
podman-compose logs -f ollama
```

3. **ç·Šæ€¥é‡å•Ÿ**
```bash
# é‡å•Ÿå–®ä¸€æœå‹™
podman-compose restart app

# å®Œæ•´é‡å•Ÿ
podman-compose down && podman-compose up -d
```

### è³‡æ–™å‚™ä»½ç¨‹åº
```bash
# è³‡æ–™åº«å‚™ä»½
podman exec spatial-postgres pg_dump -U spatial_user spatial_platform_dev > backup_$(date +%Y%m%d_%H%M%S).sql

# æª”æ¡ˆå‚™ä»½
tar -czf docs_backup_$(date +%Y%m%d_%H%M%S).tar.gz docs/
```

---

## ğŸ“‹ SOP-006: æ•ˆèƒ½ç›£æ§ç¨‹åº

### æ—¥å¸¸ç›£æ§æŒ‡æ¨™
- [ ] **å®¹å™¨è³‡æºä½¿ç”¨**: `podman stats`
- [ ] **è³‡æ–™åº«æ•ˆèƒ½**: PostGIS æŸ¥è©¢æ™‚é–“ < 100ms
- [ ] **API å›æ‡‰æ™‚é–“**: REST API < 200ms
- [ ] **WebSocket é€£ç·š**: åŒæ™‚é€£ç·šæ•¸ç›£æ§
- [ ] **AI æœå‹™**: Ollama æ¨¡å‹å›æ‡‰æ™‚é–“

### é€±æœŸæ€§æª¢æŸ¥
```bash
# æ¯é€±åŸ·è¡Œ
# 1. è³‡æ–™åº«æœ€ä½³åŒ–
podman exec spatial-postgres psql -U spatial_user -d spatial_platform_dev -c "VACUUM ANALYZE;"

# 2. æ—¥èªŒæ¸…ç†
find logs/ -name "*.log" -mtime +7 -delete

# 3. å®¹å™¨æ˜ åƒæ›´æ–°æª¢æŸ¥
podman images --format "table {{.Repository}} {{.Tag}} {{.Created}}"
```

---

## ğŸ“‹ SOP-007: éƒ¨ç½²èˆ‡ç™¼å¸ƒç¨‹åº

### é–‹ç™¼ç’°å¢ƒéƒ¨ç½²
```bash
# æ¨™æº–é–‹ç™¼éƒ¨ç½²
./scripts/dev-setup.sh

# é©—è­‰éƒ¨ç½²æˆåŠŸ
curl http://localhost:3000/health
curl http://localhost:3000/api/v1/locations
```

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²
```bash
# åˆ‡æ›ç’°å¢ƒè®Šæ•¸
cp .env.prod .env

# åŸ·è¡Œç”Ÿç”¢éƒ¨ç½²
./scripts/production-deploy.sh

# å¥åº·æª¢æŸ¥
curl https://your-domain.com/health
```

### ç‰ˆæœ¬ç™¼å¸ƒæª¢æŸ¥æ¸…å–®
- [ ] æ‰€æœ‰æ¸¬è©¦é€šé
- [ ] æ–‡æª”å·²æ›´æ–°
- [ ] è³‡æ–™åº«é·ç§»å·²åŸ·è¡Œ
- [ ] ç’°å¢ƒè®Šæ•¸å·²è¨­å®š
- [ ] å‚™ä»½å·²å®Œæˆ
- [ ] ç›£æ§å·²é…ç½®

---

## ğŸ”§ å·¥å…·èˆ‡è³‡æº

### å¿…è¦å·¥å…·
- **Go 1.21+**: ä¸»è¦é–‹ç™¼èªè¨€
- **Podman**: å®¹å™¨ç®¡ç†å·¥å…·
- **Git**: ç‰ˆæœ¬æ§åˆ¶
- **VS Code**: æ¨è–¦ç·¨è¼¯å™¨

### æœ‰ç”¨çš„æŒ‡ä»¤
```bash
# å¿«é€Ÿç‹€æ…‹æª¢æŸ¥
alias spatial-status="podman-compose ps && curl -s http://localhost:3000/health"

# å¿«é€Ÿæ—¥èªŒæŸ¥çœ‹
alias spatial-logs="podman-compose logs -f"

# å¿«é€Ÿé‡å•Ÿ
alias spatial-restart="podman-compose restart app"
```

### ç›¸é—œæ–‡æª”é€£çµ
- [PROJECT_INDEX.md](./PROJECT_INDEX.md) - è¨ˆç•«ç´¢å¼•ä¸­å¿ƒ
- [README.md](../README.md) - å°ˆæ¡ˆä¸»è¦æ–‡æª”
- [API æ–‡æª”](../README.md#APIæ–‡æª”) - REST API èªªæ˜

---

*ç‰ˆæœ¬: v1.0 | ç¶­è­·è€…: é–‹ç™¼åœ˜éšŠ | æœ€å¾Œæ›´æ–°: 2025-09-14*