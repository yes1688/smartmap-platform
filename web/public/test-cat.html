<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦è²“å’ªæ¨¡å‹</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        #container {
            width: 800px;
            height: 600px;
            border: 2px solid #444;
            margin: 20px auto;
        }
        .info {
            text-align: center;
            margin: 20px;
        }
        .loading {
            color: yellow;
        }
        .success {
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>ğŸ± è²“å’ªæ¨¡å‹æ¸¬è©¦</h1>
        <div id="status" class="loading">æ­£åœ¨è¼‰å…¥æ¨¡å‹...</div>
        <div>ç”¨æ»‘é¼ æ—‹è½‰è¦–è§’</div>
    </div>

    <div id="container"></div>

    <script>
        // ä½¿ç”¨å…¨åŸŸçš„ THREE ç‰©ä»¶

        const container = document.getElementById('container');
        const status = document.getElementById('status');

        // å‰µå»ºå ´æ™¯
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // å¤©è—è‰²èƒŒæ™¯

        // å‰µå»ºç›¸æ©Ÿ
        const camera = new THREE.PerspectiveCamera(75, 800/600, 0.1, 1000);
        camera.position.set(0, 2, 5);

        // å‰µå»ºæ¸²æŸ“å™¨
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(800, 600);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        // æ·»åŠ æ§åˆ¶å™¨
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // æ·»åŠ ç‡ˆå…‰
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 5, 5);
        directionalLight.castShadow = true;
        scene.add(directionalLight);

        // æ·»åŠ åœ°é¢
        const groundGeometry = new THREE.PlaneGeometry(10, 10);
        const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90EE90 });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // è¼‰å…¥è²“å’ªæ¨¡å‹
        const loader = new THREE.OBJLoader();

        loader.load(
            '/models/12221_Cat_v1_l3.obj',
            function (object) {
                console.log('âœ… è²“å’ªæ¨¡å‹è¼‰å…¥æˆåŠŸï¼', object);
                status.textContent = 'âœ… è²“å’ªæ¨¡å‹è¼‰å…¥æˆåŠŸï¼';
                status.className = 'success';

                // è¨­ç½®æ¨¡å‹
                object.scale.set(0.01, 0.01, 0.01); // ç¸®å°æ¨¡å‹
                object.position.set(0, 0, 0);

                // çµ¦æ¨¡å‹ä¸Šè‰²
                object.traverse(function (child) {
                    if (child.isMesh) {
                        child.material = new THREE.MeshLambertMaterial({
                            color: 0xFF6600 // æ©˜è‰²è²“å’ª
                        });
                        child.castShadow = true;
                    }
                });

                scene.add(object);

                // è¨ˆç®—æ¨¡å‹é‚Šç•Œç›’ä¾†èª¿æ•´è¦–è§’
                const box = new THREE.Box3().setFromObject(object);
                const size = box.getSize(new THREE.Vector3());
                console.log('ğŸ“ æ¨¡å‹å°ºå¯¸:', size);

                // èª¿æ•´ç›¸æ©Ÿä½ç½®
                const maxDim = Math.max(size.x, size.y, size.z);
                camera.position.set(maxDim * 2, maxDim, maxDim * 2);
                controls.target.copy(box.getCenter(new THREE.Vector3()));
                controls.update();
            },
            function (progress) {
                console.log('ğŸ“ è¼‰å…¥é€²åº¦:', (progress.loaded / progress.total * 100) + '%');
                status.textContent = `è¼‰å…¥ä¸­... ${Math.round(progress.loaded / progress.total * 100)}%`;
            },
            function (error) {
                console.error('âŒ è²“å’ªæ¨¡å‹è¼‰å…¥å¤±æ•—:', error);
                status.textContent = 'âŒ æ¨¡å‹è¼‰å…¥å¤±æ•—ï¼æª¢æŸ¥æª”æ¡ˆè·¯å¾‘æ˜¯å¦æ­£ç¢º';
                status.className = 'error';

                // é¡¯ç¤ºä¸€å€‹æ›¿ä»£çš„æ–¹å¡Š
                const geometry = new THREE.BoxGeometry(1, 1, 1);
                const material = new THREE.MeshLambertMaterial({ color: 0xFF6600 });
                const cube = new THREE.Mesh(geometry, material);
                cube.position.set(0, 0.5, 0);
                cube.castShadow = true;
                scene.add(cube);

                status.textContent += ' (é¡¯ç¤ºæ›¿ä»£æ–¹å¡Š)';
            }
        );

        // æ¸²æŸ“å¾ªç’°
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        // æ·»åŠ ä¸€äº›èª¿è©¦ä¿¡æ¯
        console.log('ğŸ”§ Three.js ç‰ˆæœ¬:', THREE.REVISION);
        console.log('ğŸ“ å˜—è©¦è¼‰å…¥æ¨¡å‹:', '/models/12221_Cat_v1_l3.obj');
    </script>
</body>
</html>