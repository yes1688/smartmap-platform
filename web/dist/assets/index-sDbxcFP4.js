import{I as rt,V as at,T as ot,C as dt,a as ct,b as ut,c as De,S as ft}from"./cesium-DuxPxTZR.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function i(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(l){if(l.ep)return;l.ep=!0;const n=i(l);fetch(l.href,n)}})();const gt=!1,ht=(e,t)=>e===t,Y=Symbol("solid-proxy"),je=Symbol("solid-track"),ve={equals:ht};let Ue=Ye;const Q=1,be=2,Je={owned:null,cleanups:null,context:null,owner:null};var j=null;let Ae=null,mt=null,A=null,E=null,U=null,Ce=0;function he(e,t){const i=A,s=j,l=e.length===0,n=t===void 0?s:t,a=l?Je:{owned:null,cleanups:null,context:n?n.context:null,owner:n},r=l?e:()=>e(()=>q(()=>ce(a)));j=a,A=null;try{return se(r,!0)}finally{A=i,j=s}}function L(e,t){t=t?Object.assign({},ve,t):ve;const i={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},s=l=>(typeof l=="function"&&(l=l(i.value)),Qe(i,l));return[qe.bind(i),s]}function B(e,t,i){const s=Le(e,t,!1,Q);ge(s)}function pt(e,t,i){Ue=yt;const s=Le(e,t,!1,Q);s.user=!0,U?U.push(s):ge(s)}function de(e,t,i){i=i?Object.assign({},ve,i):ve;const s=Le(e,t,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=i.equals||void 0,ge(s),qe.bind(s)}function vt(e){return se(e,!1)}function q(e){if(A===null)return e();const t=A;A=null;try{return e()}finally{A=t}}function Ke(e){pt(()=>q(e))}function We(e){return j===null||(j.cleanups===null?j.cleanups=[e]:j.cleanups.push(e)),e}function Me(){return A}function qe(){if(this.sources&&this.state)if(this.state===Q)ge(this);else{const e=E;E=null,se(()=>ye(this),!1),E=e}if(A){const e=this.observers?this.observers.length:0;A.sources?(A.sources.push(this),A.sourceSlots.push(e)):(A.sources=[this],A.sourceSlots=[e]),this.observers?(this.observers.push(A),this.observerSlots.push(A.sources.length-1)):(this.observers=[A],this.observerSlots=[A.sources.length-1])}return this.value}function Qe(e,t,i){let s=e.value;return(!e.comparator||!e.comparator(s,t))&&(e.value=t,e.observers&&e.observers.length&&se(()=>{for(let l=0;l<e.observers.length;l+=1){const n=e.observers[l],a=Ae&&Ae.running;a&&Ae.disposed.has(n),(a?!n.tState:!n.state)&&(n.pure?E.push(n):U.push(n),n.observers&&Xe(n)),a||(n.state=Q)}if(E.length>1e6)throw E=[],new Error},!1)),t}function ge(e){if(!e.fn)return;ce(e);const t=Ce;bt(e,e.value,t)}function bt(e,t,i){let s;const l=j,n=A;A=j=e;try{s=e.fn(t)}catch(a){return e.pure&&(e.state=Q,e.owned&&e.owned.forEach(ce),e.owned=null),e.updatedAt=i+1,Ze(a)}finally{A=n,j=l}(!e.updatedAt||e.updatedAt<=i)&&(e.updatedAt!=null&&"observers"in e?Qe(e,s):e.value=s,e.updatedAt=i)}function Le(e,t,i,s=Q,l){const n={fn:e,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:j,context:j?j.context:null,pure:i};return j===null||j!==Je&&(j.owned?j.owned.push(n):j.owned=[n]),n}function xe(e){if(e.state===0)return;if(e.state===be)return ye(e);if(e.suspense&&q(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<Ce);)e.state&&t.push(e);for(let i=t.length-1;i>=0;i--)if(e=t[i],e.state===Q)ge(e);else if(e.state===be){const s=E;E=null,se(()=>ye(e,t[0]),!1),E=s}}function se(e,t){if(E)return e();let i=!1;t||(E=[]),U?i=!0:U=[],Ce++;try{const s=e();return xt(i),s}catch(s){i||(U=null),E=null,Ze(s)}}function xt(e){if(E&&(Ye(E),E=null),e)return;const t=U;U=null,t.length&&se(()=>Ue(t),!1)}function Ye(e){for(let t=0;t<e.length;t++)xe(e[t])}function yt(e){let t,i=0;for(t=0;t<e.length;t++){const s=e[t];s.user?e[i++]=s:xe(s)}for(t=0;t<i;t++)xe(e[t])}function ye(e,t){e.state=0;for(let i=0;i<e.sources.length;i+=1){const s=e.sources[i];if(s.sources){const l=s.state;l===Q?s!==t&&(!s.updatedAt||s.updatedAt<Ce)&&xe(s):l===be&&ye(s,t)}}}function Xe(e){for(let t=0;t<e.observers.length;t+=1){const i=e.observers[t];i.state||(i.state=be,i.pure?E.push(i):U.push(i),i.observers&&Xe(i))}}function ce(e){let t;if(e.sources)for(;e.sources.length;){const i=e.sources.pop(),s=e.sourceSlots.pop(),l=i.observers;if(l&&l.length){const n=l.pop(),a=i.observerSlots.pop();s<l.length&&(n.sourceSlots[a]=s,l[s]=n,i.observerSlots[s]=a)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)ce(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)ce(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function wt(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function Ze(e,t=j){throw wt(e)}const $t=Symbol("fallback");function Be(e){for(let t=0;t<e.length;t++)e[t]()}function St(e,t,i={}){let s=[],l=[],n=[],a=0,r=t.length>1?[]:null;return We(()=>Be(n)),()=>{let d=e()||[],c=d.length,f,o;return d[je],q(()=>{let g,p,v,S,x,w,y,_,h;if(c===0)a!==0&&(Be(n),n=[],s=[],l=[],a=0,r&&(r=[])),i.fallback&&(s=[$t],l[0]=he(k=>(n[0]=k,i.fallback())),a=1);else if(a===0){for(l=new Array(c),o=0;o<c;o++)s[o]=d[o],l[o]=he(m);a=c}else{for(v=new Array(c),S=new Array(c),r&&(x=new Array(c)),w=0,y=Math.min(a,c);w<y&&s[w]===d[w];w++);for(y=a-1,_=c-1;y>=w&&_>=w&&s[y]===d[_];y--,_--)v[_]=l[y],S[_]=n[y],r&&(x[_]=r[y]);for(g=new Map,p=new Array(_+1),o=_;o>=w;o--)h=d[o],f=g.get(h),p[o]=f===void 0?-1:f,g.set(h,o);for(f=w;f<=y;f++)h=s[f],o=g.get(h),o!==void 0&&o!==-1?(v[o]=l[f],S[o]=n[f],r&&(x[o]=r[f]),o=p[o],g.set(h,o)):n[f]();for(o=w;o<c;o++)o in v?(l[o]=v[o],n[o]=S[o],r&&(r[o]=x[o],r[o](o))):l[o]=he(m);l=l.slice(0,a=c),s=d.slice(0)}return l});function m(g){if(n[o]=g,r){const[p,v]=L(o);return r[o]=v,t(d[o],p)}return t(d[o])}}}function C(e,t){return q(()=>e(t||{}))}const _t=e=>`Stale read from <${e}>.`;function Oe(e){const t="fallback"in e&&{fallback:()=>e.fallback};return de(St(()=>e.each,e.children,t||void 0))}function H(e){const t=e.keyed,i=de(()=>e.when,void 0,void 0),s=t?i:de(i,void 0,{equals:(l,n)=>!l==!n});return de(()=>{const l=s();if(l){const n=e.children;return typeof n=="function"&&n.length>0?q(()=>n(t?l:()=>{if(!q(s))throw _t("Show");return i()})):n}return e.fallback},void 0,void 0)}const ie=e=>de(()=>e());function Ct(e,t,i){let s=i.length,l=t.length,n=s,a=0,r=0,d=t[l-1].nextSibling,c=null;for(;a<l||r<n;){if(t[a]===i[r]){a++,r++;continue}for(;t[l-1]===i[n-1];)l--,n--;if(l===a){const f=n<s?r?i[r-1].nextSibling:i[n-r]:d;for(;r<n;)e.insertBefore(i[r++],f)}else if(n===r)for(;a<l;)(!c||!c.has(t[a]))&&t[a].remove(),a++;else if(t[a]===i[n-1]&&i[r]===t[l-1]){const f=t[--l].nextSibling;e.insertBefore(i[r++],t[a++].nextSibling),e.insertBefore(i[--n],f),t[l]=i[n]}else{if(!c){c=new Map;let o=r;for(;o<n;)c.set(i[o],o++)}const f=c.get(t[a]);if(f!=null)if(r<f&&f<n){let o=a,m=1,g;for(;++o<l&&o<n&&!((g=c.get(t[o]))==null||g!==f+m);)m++;if(m>f-r){const p=t[a];for(;r<f;)e.insertBefore(i[r++],p)}else e.replaceChild(i[r++],t[a++])}else a++;else t[a++].remove()}}}const Fe="_$DX_DELEGATE";function kt(e,t,i,s={}){let l;return he(n=>{l=n,t===document?e():u(t,e(),t.firstChild?null:void 0,i)},s.owner),()=>{l(),t.textContent=""}}function b(e,t,i,s){let l;const n=()=>{const r=document.createElement("template");return r.innerHTML=e,r.content.firstChild},a=()=>(l||(l=n())).cloneNode(!0);return a.cloneNode=a,a}function le(e,t=window.document){const i=t[Fe]||(t[Fe]=new Set);for(let s=0,l=e.length;s<l;s++){const n=e[s];i.has(n)||(i.add(n),t.addEventListener(n,Pt))}}function me(e,t,i){i==null?e.removeAttribute(t):e.setAttribute(t,i)}function D(e,t){t==null?e.removeAttribute("class"):e.className=t}function X(e,t,i,s){Array.isArray(i)?(e[`$$${t}`]=i[0],e[`$$${t}Data`]=i[1]):e[`$$${t}`]=i}function At(e,t,i){return q(()=>e(t,i))}function u(e,t,i,s){if(i!==void 0&&!s&&(s=[]),typeof t!="function")return we(e,t,s,i);B(l=>we(e,t(),l,i),s)}function Pt(e){let t=e.target;const i=`$$${e.type}`,s=e.target,l=e.currentTarget,n=d=>Object.defineProperty(e,"target",{configurable:!0,value:d}),a=()=>{const d=t[i];if(d&&!t.disabled){const c=t[`${i}Data`];if(c!==void 0?d.call(t,c,e):d.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&n(t.host),!0},r=()=>{for(;a()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),e.composedPath){const d=e.composedPath();n(d[0]);for(let c=0;c<d.length-2&&(t=d[c],!!a());c++){if(t._$host){t=t._$host,r();break}if(t.parentNode===l)break}}else r();n(s)}function we(e,t,i,s,l){for(;typeof i=="function";)i=i();if(t===i)return i;const n=typeof t,a=s!==void 0;if(e=a&&i[0]&&i[0].parentNode||e,n==="string"||n==="number"){if(n==="number"&&(t=t.toString(),t===i))return i;if(a){let r=i[0];r&&r.nodeType===3?r.data!==t&&(r.data=t):r=document.createTextNode(t),i=ee(e,i,s,r)}else i!==""&&typeof i=="string"?i=e.firstChild.data=t:i=e.textContent=t}else if(t==null||n==="boolean")i=ee(e,i,s);else{if(n==="function")return B(()=>{let r=t();for(;typeof r=="function";)r=r();i=we(e,r,i,s)}),()=>i;if(Array.isArray(t)){const r=[],d=i&&Array.isArray(i);if(Te(r,t,i,l))return B(()=>i=we(e,r,i,s,!0)),()=>i;if(r.length===0){if(i=ee(e,i,s),a)return i}else d?i.length===0?He(e,r,s):Ct(e,i,r):(i&&ee(e),He(e,r));i=r}else if(t.nodeType){if(Array.isArray(i)){if(a)return i=ee(e,i,s,t);ee(e,i,null,t)}else i==null||i===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);i=t}}return i}function Te(e,t,i,s){let l=!1;for(let n=0,a=t.length;n<a;n++){let r=t[n],d=i&&i[e.length],c;if(!(r==null||r===!0||r===!1))if((c=typeof r)=="object"&&r.nodeType)e.push(r);else if(Array.isArray(r))l=Te(e,r,d)||l;else if(c==="function")if(s){for(;typeof r=="function";)r=r();l=Te(e,Array.isArray(r)?r:[r],Array.isArray(d)?d:[d])||l}else e.push(r),l=!0;else{const f=String(r);d&&d.nodeType===3&&d.data===f?e.push(d):e.push(document.createTextNode(f))}}return l}function He(e,t,i=null){for(let s=0,l=t.length;s<l;s++)e.insertBefore(t[s],i)}function ee(e,t,i,s){if(i===void 0)return e.textContent="";const l=s||document.createTextNode("");if(t.length){let n=!1;for(let a=t.length-1;a>=0;a--){const r=t[a];if(l!==r){const d=r.parentNode===e;!n&&!a?d?e.replaceChild(l,r):e.insertBefore(l,i):d&&r.remove()}else n=!0}}else e.insertBefore(l,i);return[l]}const Ie=Symbol("store-raw"),te=Symbol("store-node"),G=Symbol("store-has"),et=Symbol("store-self");function tt(e){let t=e[Y];if(!t&&(Object.defineProperty(e,Y,{value:t=new Proxy(e,Ot)}),!Array.isArray(e))){const i=Object.keys(e),s=Object.getOwnPropertyDescriptors(e);for(let l=0,n=i.length;l<n;l++){const a=i[l];s[a].get&&Object.defineProperty(e,a,{enumerable:s[a].enumerable,get:s[a].get.bind(t)})}}return t}function $e(e){let t;return e!=null&&typeof e=="object"&&(e[Y]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function ue(e,t=new Set){let i,s,l,n;if(i=e!=null&&e[Ie])return i;if(!$e(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let a=0,r=e.length;a<r;a++)l=e[a],(s=ue(l,t))!==l&&(e[a]=s)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const a=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let d=0,c=a.length;d<c;d++)n=a[d],!r[n].get&&(l=e[n],(s=ue(l,t))!==l&&(e[n]=s))}return e}function Se(e,t){let i=e[t];return i||Object.defineProperty(e,t,{value:i=Object.create(null)}),i}function fe(e,t,i){if(e[t])return e[t];const[s,l]=L(i,{equals:!1,internal:!0});return s.$=l,e[t]=s}function jt(e,t){const i=Reflect.getOwnPropertyDescriptor(e,t);return!i||i.get||!i.configurable||t===Y||t===te||(delete i.value,delete i.writable,i.get=()=>e[Y][t]),i}function it(e){Me()&&fe(Se(e,te),et)()}function Mt(e){return it(e),Reflect.ownKeys(e)}const Ot={get(e,t,i){if(t===Ie)return e;if(t===Y)return i;if(t===je)return it(e),i;const s=Se(e,te),l=s[t];let n=l?l():e[t];if(t===te||t===G||t==="__proto__")return n;if(!l){const a=Object.getOwnPropertyDescriptor(e,t);Me()&&(typeof n!="function"||e.hasOwnProperty(t))&&!(a&&a.get)&&(n=fe(s,t,n)())}return $e(n)?tt(n):n},has(e,t){return t===Ie||t===Y||t===je||t===te||t===G||t==="__proto__"?!0:(Me()&&fe(Se(e,G),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Mt,getOwnPropertyDescriptor:jt};function _e(e,t,i,s=!1){if(!s&&e[t]===i)return;const l=e[t],n=e.length;i===void 0?(delete e[t],e[G]&&e[G][t]&&l!==void 0&&e[G][t].$()):(e[t]=i,e[G]&&e[G][t]&&l===void 0&&e[G][t].$());let a=Se(e,te),r;if((r=fe(a,t,l))&&r.$(()=>i),Array.isArray(e)&&e.length!==n){for(let d=e.length;d<n;d++)(r=a[d])&&r.$();(r=fe(a,"length",n))&&r.$(e.length)}(r=a[et])&&r.$()}function st(e,t){const i=Object.keys(t);for(let s=0;s<i.length;s+=1){const l=i[s];_e(e,l,t[l])}}function Tt(e,t){if(typeof t=="function"&&(t=t(e)),t=ue(t),Array.isArray(t)){if(e===t)return;let i=0,s=t.length;for(;i<s;i++){const l=t[i];e[i]!==l&&_e(e,i,l)}_e(e,"length",s)}else st(e,t)}function ae(e,t,i=[]){let s,l=e;if(t.length>1){s=t.shift();const a=typeof s,r=Array.isArray(e);if(Array.isArray(s)){for(let d=0;d<s.length;d++)ae(e,[s[d]].concat(t),i);return}else if(r&&a==="function"){for(let d=0;d<e.length;d++)s(e[d],d)&&ae(e,[d].concat(t),i);return}else if(r&&a==="object"){const{from:d=0,to:c=e.length-1,by:f=1}=s;for(let o=d;o<=c;o+=f)ae(e,[o].concat(t),i);return}else if(t.length>1){ae(e[s],t,[s].concat(i));return}l=e[s],i=[s].concat(i)}let n=t[0];typeof n=="function"&&(n=n(l,i),n===l)||s===void 0&&n==null||(n=ue(n),s===void 0||$e(l)&&$e(n)&&!Array.isArray(n)?st(l,n):_e(e,s,n))}function lt(...[e,t]){const i=ue(e||{}),s=Array.isArray(i),l=tt(i);function n(...a){vt(()=>{s&&a.length===1?Tt(i,a[0]):ae(i,a)})}return[l,n]}const T={api:{baseUrl:window.location.origin+"/api/v1",endpoints:{locations:"/locations",historicalSites:"/historical-sites",voiceProcess:"/voice/process",aiChat:"/ai/chat",gameStatus:"/game/status",gameCollect:"/game/collect",gameMove:"/game/move"}},websocket:{url:`ws://${window.location.host}/ws`},cesium:{accessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI5M2M4Njk1My02Y2NiLTQ0OWQtYWZmOS05ZDJlNjRjN2YzODUiLCJpZCI6NzM2NzIsImlhdCI6MTc1NzgxNjA3MH0.Bps4cz4M6_sFFrh1qHjc8CS7UVGJBBchdsK4VhipdKA",defaultView:{longitude:121.5654,latitude:25.033,height:1e3},terrain:{url:"https://assets.agi.com/stk-terrain/world"}},game:{collectionRadius:50,itemSpawnInterval:3e4,maxItemsOnMap:10,scoreValues:{common:10,rare:50,legendary:100},itemColors:{common:"#4CAF50",rare:"#2196F3",legendary:"#FF9800"}},voice:{language:"zh-TW",recognitionTimeout:5e3,supportedCommands:["navigate","collect","introduce","status"]},ai:{maxMessageLength:500,responseTimeout:1e4,contextWindow:5},mapStyles:{playerMarker:{image:"🧑‍🚀",scale:1.5,color:"#FF6B6B"},historicalSite:{image:"🏛️",scale:1.2,color:"#9C27B0"},itemMarker:{scale:.8,heightReference:"CLAMP_TO_GROUND"}},ui:{animationDuration:300,notificationTimeout:3e3,panelTransition:"all 0.3s ease-in-out"},defaultBounds:{north:25.3,south:24.7,east:121.8,west:121.3}},[V,O]=lt({player:void 0,playerStats:{playerId:"",totalScore:0,totalSessions:0,totalItems:0,averageScore:0,bestScore:0,totalPlayTime:0,lastPlayed:void 0},nearbyItems:[],gameSession:void 0,isGameActive:!1}),[wi,Re]=L(!1),[$i,It]=L(""),Ee={async initializeGame(e){Re(!0);try{await Et(e),await Vt(e),O("isGameActive",!0)}catch(t){console.error("Failed to initialize game:",t)}finally{Re(!1)}},async updatePlayerPosition(e,t){if(V.player)try{const i=await fetch(`${T.api.baseUrl}${T.api.endpoints.gameMove}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:V.player.id,lat:e,lng:t})});if(i.ok){const s=await i.json();O("player","latitude",e),O("player","longitude",t),s.historicalSite&&zt(s.historicalSite,s.aiIntroduction)}}catch(i){console.error("Failed to update player position:",i)}},async collectItem(e,t,i){if(!V.player)return null;try{const s=await fetch(`${T.api.baseUrl}${T.api.endpoints.gameCollect}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:V.player.id,itemId:e,lat:t,lng:i})});if(s.ok){const n=(await s.json()).data;if(n.success){O("playerStats","totalScore",n.totalScore),O("playerStats","totalItems",r=>r+1);const a=Ge(n.totalScore);return a>V.player.level&&(O("player","level",a),oe(`升級到第 ${a} 級！`)),O("nearbyItems",r=>r.filter(d=>d.id!==e)),n.item&&oe(`收集到 ${n.item.name}！+${n.score} 分`),n}}}catch(s){console.error("Failed to collect item:",s)}return null},awardPoints(e,t){const i=V.playerStats.totalScore+e;if(O("playerStats","totalScore",i),V.player){const s=Ge(i);s>V.player.level&&(O("player","level",s),oe(`升級到第 ${s} 級！`))}oe(`${t} +${e} 分`)},updateNearbyItems(){},getPlayerStats(){return V.playerStats},async endGameSession(){if(V.gameSession)try{(await fetch(`${T.api.baseUrl}/game/sessions/${V.gameSession.id}/end`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:V.playerStats.totalScore,duration:Math.floor((Date.now()-new Date(V.gameSession.startTime).getTime())/1e3)})})).ok&&(O("gameSession",void 0),O("isGameActive",!1))}catch(e){console.error("Failed to end game session:",e)}}};async function Et(e){try{const t=await fetch(`${T.api.baseUrl}${T.api.endpoints.gameStatus}?playerId=${e}`);if(t.ok){const i=await t.json();if(i.data){const s=i.data;O("player",s),O("playerStats",{playerId:e,totalScore:s.score,totalSessions:0,totalItems:0,averageScore:s.score,bestScore:s.score,totalPlayTime:0})}}else await Lt(e)}catch(t){console.error("Failed to load player stats:",t),nt(e)}}async function Lt(e){try{const t=await fetch(`${T.api.baseUrl}/game/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,name:`Player_${e.substring(0,8)}`,latitude:T.cesium.defaultView.latitude,longitude:T.cesium.defaultView.longitude})});if(t.ok){const s=(await t.json()).data;O("player",s)}}catch(t){console.error("Failed to create new player:",t),nt(e)}}function nt(e){const t={id:e,name:`Player_${e.substring(0,8)}`,latitude:T.cesium.defaultView.latitude,longitude:T.cesium.defaultView.longitude,level:1,score:0,items:0};O("player",t),O("playerStats",{playerId:e,totalScore:0,totalSessions:1,totalItems:0,averageScore:0,bestScore:0,totalPlayTime:0,lastPlayed:new Date})}async function Vt(e){try{const t=await fetch(`${T.api.baseUrl}/game/sessions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerId:e})});if(t.ok){const i=await t.json();O("gameSession",i.data)}}catch(t){console.error("Failed to start game session:",t)}}function Ge(e){return Math.floor(e/100)+1}function zt(e,t){console.log("🏛️ Historical site encountered:",e.name),Ee.awardPoints(25,"發現歷史景點"),oe(`發現歷史景點：${e.name}`)}function oe(e){const t=new Date().toLocaleTimeString();It(`${t} - ${e}`)}const pe={get currentPlayer(){return V.player},get playerStats(){return V.playerStats}};var Nt=b('<header class="nav sticky top-0 z-50 animate-fade-in"><div class=container><div class="flex items-center justify-between h-16"><div class="flex items-center space-x-4"><div class="flex items-center space-x-3"><div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center shadow-sm"><svg class="w-5 h-5 text-white"fill=currentColor viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg></div><div><h1 class="text-heading-sm text-primary">智能空間平台</h1><p class="text-body-sm text-secondary">Intelligent Spatial Platform</p></div></div></div><nav class="hidden lg:flex items-center space-x-1 bg-white/50 rounded-2xl p-2 border border-neutral-200/50"></nav><div class="flex items-center space-x-3"><button class="btn-ghost btn-icon group relative"title=語音控制><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M12 1v6m0 0l4-4m-4 4L8 3m0 18v-6m0 0l4 4m-4-4l-4 4"></path></svg><div class="absolute -inset-2 rounded-lg bg-neutral-100 opacity-0 group-hover:opacity-100 transition-opacity -z-10"></div></button><button class="btn-primary space-x-2"><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"></path></svg><span>AI 助手</span></button><div class="flex items-center space-x-2 bg-surface border border-neutral-200/50 rounded-full px-3 py-2"><div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse-subtle"></div><div class="flex flex-col"><span class="text-body-sm text-primary font-semibold"></span><span class="text-caption text-tertiary">積分</span></div></div><button class="w-9 h-9 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white shadow-sm hover:shadow-md transition-all"><svg class="w-4 h-4"fill=currentColor viewBox="0 0 20 20"><path fill-rule=evenodd d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"clip-rule=evenodd>'),Dt=b('<button><svg class="w-4 h-4"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5></path></svg><span class="text-body-md font-medium">');const Bt=e=>{const[t,i]=L("explore"),s=[{id:"explore",label:"探索",icon:"M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z"},{id:"analytics",label:"分析",icon:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"},{id:"settings",label:"設定",icon:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"}];return(()=>{var l=Nt(),n=l.firstChild,a=n.firstChild,r=a.firstChild,d=r.nextSibling,c=d.nextSibling,f=c.firstChild,o=f.nextSibling,m=o.nextSibling,g=m.firstChild,p=g.nextSibling,v=p.firstChild;return u(d,()=>s.map(S=>(()=>{var x=Dt(),w=x.firstChild,y=w.firstChild,_=w.nextSibling;return x.$$click=()=>i(S.id),u(_,()=>S.label),B(h=>{var k=`nav-item flex items-center space-x-2 px-4 py-2.5 rounded-xl transition-all duration-200 ${t()===S.id?"nav-item active bg-white shadow-sm":"text-secondary hover:text-primary hover:bg-white/50"}`,M=S.icon;return k!==h.e&&D(x,h.e=k),M!==h.t&&me(y,"d",h.t=M),h},{e:void 0,t:void 0}),x})())),X(f,"click",e.onToggleVoice),X(o,"click",e.onToggleChat),u(v,()=>pe.playerStats.totalScore),l})()};le(["click"]);var Ft=b('<div class="w-full h-full relative overflow-hidden"><div class="w-full h-full"style="min-height:400px;height:calc(100vh - 65px)"></div><div class="absolute bottom-6 left-6 z-20"><div class="card p-4 space-y-2"><div class="flex items-center space-x-2"><div class="w-2 h-2 bg-blue-500 rounded-full animate-pulse-subtle"></div><span class="text-body-sm text-secondary">當前位置</span></div><div class=space-y-1><p class="text-body-sm text-primary font-mono">緯度: </p><p class="text-body-sm text-primary font-mono">經度: '),Ht=b('<div class="absolute inset-0 bg-white/95 backdrop-blur-sm flex items-center justify-center z-30"><div class="text-center space-y-4 animate-scale-in"><div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center mx-auto shadow-lg animate-pulse-subtle"><svg class="w-8 h-8 text-white"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2z"></path></svg></div><div class=space-y-2><h3 class="text-heading-sm text-primary">載入 CesiumJS 3D 地圖</h3><p class="text-body-md text-secondary">初始化地球儀系統...');const Rt=e=>{let t,i;const[s,l]=L({latitude:25.033,longitude:121.5654});L("satellite");const[n,a]=L(!0);return s().latitude,s().longitude,Ke(async()=>{console.log("🗺️ Initializing CesiumJS 3D Map");try{rt.defaultAccessToken=T.cesium.accessToken,i=new at(t,{terrain:ot.fromWorldTerrain(),baseLayerPicker:!1,geocoder:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,animation:!1,timeline:!1,fullscreenButton:!1,vrButton:!1,scene3DOnly:!0}),window.cesiumViewer=i,i.scene.globe.show=!0,i.scene.skyBox.show=!0,i.scene.backgroundColor=dt.DARKSLATEGRAY,i.scene.globe.enableLighting=!1,i.scene.fog.enabled=!1,i.scene.skyAtmosphere.show=!0,i.camera.setView({destination:ct.fromDegrees(T.cesium.defaultView.longitude,T.cesium.defaultView.latitude,T.cesium.defaultView.height)}),i.cesiumWidget.screenSpaceEventHandler.setInputAction(r=>{const d=i.camera.pickEllipsoid(r.position,i.scene.globe.ellipsoid);if(d){const c=ut.fromCartesian(d),f=De.toDegrees(c.longitude),o=De.toDegrees(c.latitude);l({latitude:o,longitude:f}),e.onPlayerMove(o,f)}},ft.LEFT_CLICK),a(!1),console.log("🗺️ CesiumJS 3D Map initialized successfully")}catch(r){console.error("Failed to initialize CesiumJS:",r),a(!1)}}),We(()=>{i&&i.destroy()}),(()=>{var r=Ft(),d=r.firstChild,c=d.nextSibling,f=c.firstChild,o=f.firstChild,m=o.nextSibling,g=m.firstChild;g.firstChild;var p=g.nextSibling;p.firstChild;var v=t;return typeof v=="function"?At(v,d):t=d,u(r,(()=>{var S=ie(()=>!!n());return()=>S()&&Ht()})(),c),u(g,()=>s().latitude.toFixed(6),null),u(p,()=>s().longitude.toFixed(6),null),r})()};var Gt=b('<div class="p-6 space-y-6 animate-fade-in"><div><div class="flex items-center justify-between mb-4"><h4 class="text-heading-sm text-primary">數據概覽</h4><div class="flex items-center space-x-1"><div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse-subtle"></div><span class="text-body-sm text-secondary">即時</span></div></div><div class="grid gap-4"></div></div><div class=divider></div><div><h4 class="text-heading-sm text-primary mb-4">系統狀態</h4><div class="card p-4"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-3 h-3 bg-emerald-500 rounded-full animate-pulse-subtle"></div><div><p class="text-body-md text-primary font-medium">運行中</p><p class="text-body-sm text-secondary">系統正常運作</p></div></div><div class=text-right><p class="text-body-sm text-secondary">連線品質</p><div class="flex items-center space-x-1 mt-1"><div class="w-1 h-4 bg-emerald-500 rounded-full"></div><div class="w-1 h-4 bg-emerald-500 rounded-full"></div><div class="w-1 h-4 bg-emerald-500 rounded-full"></div><div class="w-1 h-3 bg-emerald-500 rounded-full"></div><span class="text-body-sm text-primary font-medium ml-2">優良</span></div></div></div></div></div><div class=divider></div><div><h4 class="text-heading-sm text-primary mb-4">最近活動</h4><div class=space-y-3>'),Ut=b('<div class="p-4 flex items-center justify-center"><button class="w-full btn-ghost text-center py-3 rounded-xl"><svg class="w-6 h-6 mx-auto text-secondary"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M9 5l7 7-7 7">'),Jt=b('<div><div class="card-elevated animate-slide-up"><div class="p-6 border-b border-neutral-200/50"><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-sm"><svg class="w-6 h-6 text-white"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></div><div><h3 class="text-heading-sm text-primary">控制台</h3><p class="text-body-sm text-secondary">即時數據監控</p></div></div><button class="btn-ghost btn-icon group"><svg fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M12 4v16m8-8H4">'),Kt=b('<div class="card-interactive p-4"><div class="flex items-center justify-between"><div class=flex-1><div class="flex items-center space-x-3 mb-2"><div><svg class="w-5 h-5 text-white"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5></path></svg></div><div><p class="text-body-sm text-secondary"></p><p class="text-heading-lg text-primary font-bold"></p></div></div><div class="flex items-center space-x-2"><span>'),Wt=b('<svg class="w-4 h-4 text-emerald-500"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6">'),qt=b('<svg class="w-4 h-4 text-red-500"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6">'),Qt=b('<div class="flex items-center space-x-3 p-3 rounded-xl hover:bg-neutral-50/50 transition-colors"><div class=text-2xl></div><div class=flex-1><p class="text-body-md text-primary font-medium"></p><p class="text-body-sm text-secondary"></p></div><svg class="w-4 h-4 text-tertiary"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M9 5l7 7-7 7">');const Yt=e=>{var s;L("overview");const t=[{id:"level",title:"等級",value:((s=pe.currentPlayer)==null?void 0:s.level)||1,change:"+2 本週",trend:"up",icon:"M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228a25.073 25.073 0 012.916.52 6.003 6.003 0 01-4.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0A6.772 6.772 0 0112 15.75c-2.622 0-5.033-.732-7.2-2z",color:"from-blue-500 to-blue-600"},{id:"score",title:"積分",value:pe.playerStats.totalScore,change:"+156 今天",trend:"up",icon:"M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.228a25.073 25.073 0 012.916.52 6.003 6.003 0 01-4.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0A6.772 6.772 0 0112 15.75c-2.622 0-5.033-.732-7.2-2z",color:"from-emerald-500 to-emerald-600"},{id:"items",title:"道具",value:pe.playerStats.totalItems,change:"穩定",trend:"neutral",icon:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125",color:"from-purple-500 to-purple-600"}],i=[{time:"2分鐘前",action:"探索新區域",type:"explore",icon:"🗺️"},{time:"5分鐘前",action:"獲得成就獎勵",type:"achievement",icon:"🏆"},{time:"12分鐘前",action:"與AI助手對話",type:"chat",icon:"💬"},{time:"18分鐘前",action:"收集稀有道具",type:"item",icon:"💎"}];return(()=>{var l=Jt(),n=l.firstChild,a=n.firstChild,r=a.firstChild,d=r.firstChild,c=d.nextSibling,f=c.firstChild;return X(c,"click",e.onToggle),u(n,C(H,{get when(){return e.isExpanded},get children(){var o=Gt(),m=o.firstChild,g=m.firstChild,p=g.nextSibling,v=m.nextSibling,S=v.nextSibling,x=S.nextSibling,w=x.nextSibling,y=w.firstChild,_=y.nextSibling;return u(p,C(Oe,{each:t,children:h=>(()=>{var k=Kt(),M=k.firstChild,J=M.firstChild,F=J.firstChild,P=F.firstChild,ke=P.firstChild,$=ke.firstChild,z=P.nextSibling,R=z.firstChild,K=R.nextSibling,Z=F.nextSibling,W=Z.firstChild;return u(R,()=>h.title),u(K,()=>h.value),u(Z,(()=>{var N=ie(()=>h.trend==="up");return()=>N()&&Wt()})(),W),u(Z,(()=>{var N=ie(()=>h.trend==="down");return()=>N()&&qt()})(),W),u(W,()=>h.change),B(N=>{var I=`w-10 h-10 bg-gradient-to-br ${h.color} rounded-xl flex items-center justify-center shadow-sm`,ne=h.icon,re=`text-body-sm font-medium ${h.trend==="up"?"text-emerald-600":h.trend==="down"?"text-red-600":"text-secondary"}`;return I!==N.e&&D(P,N.e=I),ne!==N.t&&me($,"d",N.t=ne),re!==N.a&&D(W,N.a=re),N},{e:void 0,t:void 0,a:void 0}),k})()})),u(_,C(Oe,{each:i,children:h=>(()=>{var k=Qt(),M=k.firstChild,J=M.nextSibling,F=J.firstChild,P=F.nextSibling;return u(M,()=>h.icon),u(F,()=>h.action),u(P,()=>h.time),k})()})),o}}),null),u(n,C(H,{get when(){return!e.isExpanded},get children(){var o=Ut(),m=o.firstChild;return X(m,"click",e.onToggle),o}}),null),B(o=>{var m=`fixed top-6 right-6 w-96 transition-all duration-500 ease-out z-30 ${e.isExpanded?"translate-x-0":"translate-x-80"}`,g=e.isExpanded?"收起面板":"展開面板",p=`w-5 h-5 transition-transform duration-300 ${e.isExpanded?"rotate-45":""}`;return m!==o.e&&D(l,o.e=m),g!==o.t&&me(c,"title",o.t=g),p!==o.a&&me(f,"class",o.a=p),o},{e:void 0,t:void 0,a:void 0}),l})()};le(["click"]);var Xt=b('<div class="flex justify-start animate-fadeIn"><div class="relative ml-3"><div class="absolute -left-3 top-0 w-6 h-6 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center shadow-sm"><span class="text-white text-xs">🤖</span></div><div class="bg-gradient-to-br from-white to-gray-50 text-gray-800 rounded-2xl rounded-bl-md p-4 max-w-[85%] shadow-lg border border-gray-200/50"><div class="flex items-center gap-3"><div class="flex space-x-1"><div class="w-2 h-2 bg-gradient-to-r from-emerald-400 to-teal-500 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-gradient-to-r from-emerald-400 to-teal-500 rounded-full animate-bounce"style=animation-delay:0.1s></div><div class="w-2 h-2 bg-gradient-to-r from-emerald-400 to-teal-500 rounded-full animate-bounce"style=animation-delay:0.2s></div></div><span class="text-sm text-gray-600 font-medium">AI 正在思考...</span></div><div class="absolute bottom-2 -left-2 w-4 h-4 bg-gradient-to-br from-white to-gray-50 border-l border-b border-gray-200/50 transform rotate-45">'),Zt=b('<div class="absolute top-5 left-5 w-96 max-w-[90vw] h-[500px] bg-gradient-to-br from-white/95 via-slate-50/95 to-gray-100/95 backdrop-blur-md rounded-2xl shadow-2xl border border-white/50 z-10 flex flex-col overflow-hidden"><div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 via-blue-500/5 to-purple-500/5 rounded-2xl"></div><div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-400 via-blue-500 to-purple-600 rounded-t-2xl"></div><div class="relative p-4 border-b border-gradient-to-r from-gray-200/50 to-gray-300/50 bg-gradient-to-r from-emerald-50/80 via-teal-50/80 to-blue-50/80 rounded-t-2xl"><div class="flex justify-between items-center"><div class="flex items-center gap-3"><div class=relative><div class="w-10 h-10 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-xl flex items-center justify-center shadow-lg"><span class="text-white text-lg">🤖</span></div><div class="absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-r from-green-400 to-emerald-500 rounded-full animate-pulse shadow-sm"><div class="w-full h-full bg-white rounded-full flex items-center justify-center"><div class="w-2 h-2 bg-green-500 rounded-full"></div></div></div></div><div><h3 class="font-bold text-gray-800 text-lg">AI 智能助手</h3><p class="text-xs text-gray-500 font-medium">隨時為您服務</p></div></div><button class="group relative w-8 h-8 bg-gradient-to-br from-red-100 to-red-200 hover:from-red-200 hover:to-red-300 text-red-600 hover:text-red-700 transition-all duration-300 rounded-lg shadow-sm hover:shadow-md active:scale-95"><span class="text-lg font-bold transition-transform duration-300 group-hover:scale-110">×</span></button></div></div><div class="relative flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-transparent"></div><div class="relative p-4 border-t border-gray-200/50 bg-gradient-to-r from-gray-50/90 via-white/90 to-gray-50/90 backdrop-blur-sm rounded-b-2xl"><div class="relative flex gap-3"><div class="flex-1 relative"><textarea placeholder=輸入訊息或語音指令... class="w-full px-4 py-3 pr-12 border-2 border-gray-200/50 bg-white/80 backdrop-blur-sm rounded-xl resize-none focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-400/50 transition-all duration-300 shadow-sm hover:shadow-md text-sm leading-relaxed"rows=1></textarea><div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"><span class=text-xs>💬</span></div></div><button class="group relative px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 disabled:from-gray-300 disabled:to-gray-400 text-white rounded-xl disabled:cursor-not-allowed transition-all duration-300 shadow-lg hover:shadow-xl disabled:shadow-sm active:scale-95 font-medium text-sm"><div class="flex items-center gap-2"><span></span><span class="hidden sm:inline"></span></div><div class="absolute inset-0 rounded-xl bg-gradient-to-r from-white/0 via-white/10 to-white/0 opacity-0 group-hover:opacity-100 disabled:opacity-0 transition-opacity duration-300"></div></button></div><div class="mt-2 flex flex-wrap gap-2">'),ei=b('<div><div><div><div class="whitespace-pre-wrap break-words text-sm leading-relaxed"></div><div></div><div>'),ti=b('<div class="absolute -left-3 top-0 w-6 h-6 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center shadow-sm"><span class="text-white text-xs">🤖'),ii=b('<button class="px-3 py-1.5 text-xs bg-gradient-to-r from-gray-100 to-gray-200 hover:from-emerald-100 hover:to-teal-100 text-gray-600 hover:text-emerald-700 rounded-full transition-all duration-200 border border-gray-200/50 hover:border-emerald-300/50 hover:shadow-sm">');const si=e=>{const[t,i]=L([{id:"1",sender:"ai",message:"您好！我是智能空間平台的AI助手，很高興為您服務！有什麼我可以幫助您的嗎？",timestamp:Date.now()-5e3}]),[s,l]=L(""),[n,a]=L(!1),r=async()=>{const o=s().trim();if(!o||n())return;const m={id:Date.now().toString(),sender:"user",message:o,timestamp:Date.now()};i(g=>[...g,m]),l(""),a(!0);try{setTimeout(()=>{const g={id:(Date.now()+1).toString(),sender:"ai",message:c(o)||"我正在思考您的問題...",timestamp:Date.now()};i(p=>[...p,g]),a(!1)},1e3)}catch(g){console.error("Failed to send message:",g),a(!1)}},d=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),r())},c=o=>{const m=o.toLowerCase(),g={你好:"您好！我是智能空間平台的AI助手，很高興為您服務！有什麼我可以幫助您的嗎？",怎麼玩:`這是一個結合3D地圖和收集遊戲的平台！您可以：
• 在地圖上移動探索
• 收集散落的物品獲得分數
• 發現歷史景點聆聽介紹
• 使用語音控制與我對話`,語音控制:`您可以使用以下語音指令：
• "導航到..." - 地圖導航
• "收集附近物品" - 自動收集
• "介紹這個地方" - 獲取景點資訊
• "我的分數" - 查看遊戲狀態`,分數:`您可以透過以下方式獲得分數：
• 收集地圖上的物品（10-100分）
• 發現歷史景點（25分）
• 完成特殊任務`,幫助:`我可以協助您：
• 🗺️ 地圖導航和位置查詢
• 🎮 遊戲規則和策略建議
• 🏛️ 歷史景點介紹和文化知識
• 🎤 語音控制指導
• 📊 遊戲統計和進度追蹤`};for(const[p,v]of Object.entries(g))if(m.includes(p))return v;return null},f=o=>new Date(o).toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"});return(()=>{var o=Zt(),m=o.firstChild,g=m.nextSibling,p=g.nextSibling,v=p.firstChild,S=v.firstChild,x=S.nextSibling,w=p.nextSibling,y=w.nextSibling,_=y.firstChild,h=_.firstChild,k=h.firstChild,M=h.nextSibling,J=M.firstChild,F=J.firstChild,P=F.nextSibling,ke=_.nextSibling;return X(x,"click",e.onClose),u(w,C(Oe,{get each(){return t()},children:$=>(()=>{var z=ei(),R=z.firstChild,K=R.firstChild,Z=K.firstChild,W=Z.nextSibling,N=W.nextSibling;return u(R,(()=>{var I=ie(()=>$.sender==="ai");return()=>I()&&ti()})(),K),u(Z,()=>$.message),u(W,()=>f($.timestamp)),B(I=>{var ne=`flex ${$.sender==="user"?"justify-end":"justify-start"} animate-fadeIn`,re=`relative group max-w-[85%] ${$.sender==="user"?"order-1":"order-2"}`,Ve=`relative p-4 shadow-lg transition-all duration-300 group-hover:shadow-xl ${$.sender==="user"?"bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-2xl rounded-br-md ml-3":"bg-gradient-to-br from-white to-gray-50 text-gray-800 rounded-2xl rounded-bl-md border border-gray-200/50 ml-3"}`,ze=`text-xs mt-2 flex justify-end ${$.sender==="user"?"text-indigo-100/80":"text-gray-400"}`,Ne=`absolute ${$.sender==="user"?"bottom-2 -right-2 w-4 h-4 bg-gradient-to-br from-indigo-500 to-purple-600 transform rotate-45":"bottom-2 -left-2 w-4 h-4 bg-gradient-to-br from-white to-gray-50 border-l border-b border-gray-200/50 transform rotate-45"}`;return ne!==I.e&&D(z,I.e=ne),re!==I.t&&D(R,I.t=re),Ve!==I.a&&D(K,I.a=Ve),ze!==I.o&&D(W,I.o=ze),Ne!==I.i&&D(N,I.i=Ne),I},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),z})()}),null),u(w,C(H,{get when(){return n()},get children(){return Xt()}}),null),k.addEventListener("keypress",d),k.$$input=$=>l($.currentTarget.value),M.$$click=r,u(F,()=>n()?"⏳":"📤"),u(P,()=>n()?"發送中":"發送"),u(ke,()=>["你好","怎麼玩","幫助"].map($=>(()=>{var z=ii();return z.$$click=()=>l($),u(z,$),B(()=>z.disabled=n()),z})())),B($=>{var z=n(),R=!s().trim()||n(),K=`transition-transform duration-300 ${n()?"animate-spin":"group-hover:scale-110"}`;return z!==$.e&&(k.disabled=$.e=z),R!==$.t&&(M.disabled=$.t=R),K!==$.a&&D(F,$.a=K),$},{e:void 0,t:void 0,a:void 0}),B(()=>k.value=s()),o})()};le(["click","input"]);var li=b("<button>"),ni=b('<div class="mt-2 text-sm text-gray-600">'),ri=b('<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"><div class="bg-white rounded-2xl shadow-2xl p-6 w-96 max-w-[90vw] mx-4"><div class="flex justify-between items-center mb-6"><h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2"><span class=text-2xl>🎤</span>語音控制</h3><button class="text-gray-500 hover:text-gray-700 transition-colors p-1 rounded-lg hover:bg-gray-100"><span class=text-xl>×</span></button></div><div class=mb-6><div></div></div><div class="text-center mb-6"></div><div class="bg-gray-50 rounded-lg p-4"><h4 class="font-medium text-gray-800 mb-3 flex items-center gap-2"><span class=text-blue-500>💡</span>語音指令範例</h4><ul class="space-y-2 text-sm text-gray-600"><li class="flex items-start gap-2"><span class=text-blue-500>▸</span>"導航到最近的歷史景點"</li><li class="flex items-start gap-2"><span class=text-blue-500>▸</span>"收集附近的物品"</li><li class="flex items-start gap-2"><span class=text-blue-500>▸</span>"介紹這個地方"</li><li class="flex items-start gap-2"><span class=text-blue-500>▸</span>"顯示我的遊戲統計"'),ai=b('<div class="text-red-600 text-center">此瀏覽器不支援語音識別功能');const oi=e=>{const[t,i]=L(!1),[s,l]=L("準備就緒"),[n]=L(typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window)),a=()=>{t()?d():r()},r=()=>{i(!0),l("連接外部語音處理服務中..."),setTimeout(()=>{l("語音處理由外部專案處理"),i(!1)},2e3)},d=()=>{i(!1),l("準備就緒")};return(()=>{var c=ri(),f=c.firstChild,o=f.firstChild,m=o.firstChild,g=m.nextSibling,p=o.nextSibling,v=p.firstChild,S=p.nextSibling;return X(g,"click",e.onClose),u(v,s),u(S,C(H,{get when(){return n()},get fallback(){return ai()},get children(){return[(()=>{var x=li();return x.$$click=a,u(x,()=>t()?"⏹️":"🎤"),B(()=>D(x,`
                w-20 h-20 rounded-full text-white text-2xl font-bold transition-all duration-200 shadow-lg
                ${t()?"bg-red-500 hover:bg-red-600 animate-pulse scale-110":"bg-red-500 hover:bg-red-600 hover:scale-105"}
              `)),x})(),(()=>{var x=ni();return u(x,()=>t()?"點擊停止錄音":"點擊開始錄音"),x})()]}})),B(()=>D(v,`
            p-4 rounded-lg text-center font-medium transition-colors
            ${t()?"bg-red-100 text-red-700 animate-pulse":"bg-green-100 text-green-700"}
          `)),c})()};le(["click"]);var di=b('<div class="flex items-start gap-2 text-sm text-gray-600"><span class=mt-0.5>📍</span><span>'),ci=b('<div class="bg-gradient-to-r from-blue-50 to-purple-50 p-3 rounded-lg border-l-4 border-l-indigo-500"><div class="flex items-center gap-2 mb-2"><span class=text-indigo-500>🤖</span><span class="font-medium text-indigo-700">AI 導覽介紹</span></div><p class="text-gray-700 leading-relaxed">'),ui=b('<button class="flex items-center gap-2 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors"><span>🖼️</span><span class="text-sm font-medium">查看圖片'),fi=b('<div class="absolute bottom-5 left-5 w-[400px] max-w-[90vw] bg-white/95 backdrop-blur-sm rounded-xl shadow-lg z-10"><div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gradient-to-r from-purple-50 to-indigo-50 rounded-t-xl"><h3 class="font-semibold text-gray-800 flex items-center gap-2"><span class=text-lg>🏛️</span></h3><button class="text-gray-600 hover:text-gray-800 transition-colors p-1 rounded hover:bg-gray-100"><span class=text-lg>×</span></button></div><div class="p-4 space-y-4"><div><p class="text-gray-700 leading-relaxed"></p></div><div class="flex items-center gap-2 text-sm"><span class="font-medium text-gray-600">歷史年代:</span><span class="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full font-medium"></span></div><div class="flex items-center gap-2 text-sm text-gray-600"><span>👥 參觀人次:</span><span class=font-medium></span></div><div class="flex gap-2 pt-2"><button class="flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors"><span>🔊</span><span class="text-sm font-medium">播放語音介紹</span></button></div><div class="pt-2 border-t border-gray-200"><div class="text-xs text-gray-500 space-y-1"><div>緯度: </div><div>經度: ');const gi=e=>{const t=()=>{if(console.log("Playing audio guide for:",e.site.name),"speechSynthesis"in window){const i=new SpeechSynthesisUtterance(`歡迎來到 ${e.site.name}。${e.site.description}`);i.lang="zh-TW",speechSynthesis.speak(i)}};return(()=>{var i=fi(),s=i.firstChild,l=s.firstChild;l.firstChild;var n=l.nextSibling,a=s.nextSibling,r=a.firstChild,d=r.firstChild,c=r.nextSibling,f=c.firstChild,o=f.nextSibling,m=c.nextSibling,g=m.firstChild,p=g.nextSibling,v=m.nextSibling,S=v.firstChild,x=v.nextSibling,w=x.firstChild,y=w.firstChild;y.firstChild;var _=y.nextSibling;return _.firstChild,u(l,()=>e.site.name,null),X(n,"click",e.onClose),u(d,()=>e.site.description),u(o,()=>e.site.era),u(p,()=>e.site.visitCount.toLocaleString()),u(a,C(H,{get when(){return e.site.address},get children(){var h=di(),k=h.firstChild,M=k.nextSibling;return u(M,()=>e.site.address),h}}),v),u(a,C(H,{get when(){return e.site.aiIntroduction},get children(){var h=ci(),k=h.firstChild,M=k.nextSibling;return u(M,()=>e.site.aiIntroduction),h}}),v),S.$$click=t,u(v,C(H,{get when(){return ie(()=>!!e.site.images)()&&e.site.images.length>0},get children(){return ui()}}),null),u(y,()=>e.site.latitude.toFixed(6),null),u(_,()=>e.site.longitude.toFixed(6),null),i})()};le(["click"]);var hi=b('<div class="fixed inset-0 bg-white/90 backdrop-blur-sm flex flex-col justify-center items-center z-[9999]"><div class="relative mb-4"><div class="w-16 h-16 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div><div class="absolute inset-0 flex items-center justify-center"><span class=text-2xl>🌍</span></div></div><div class="text-lg font-medium text-indigo-600 mb-2"></div><div class="text-sm text-gray-600">正在初始化智能空間平台');const mi=e=>(()=>{var t=hi(),i=t.firstChild,s=i.nextSibling;return u(s,()=>e.message||"載入中..."),t})();var Pe=b("<div class=pointer-events-auto>"),pi=b('<div class="fixed inset-0 z-[100] pointer-events-auto">'),vi=b('<div class="min-h-screen bg-neutral-50 flex flex-col relative overflow-hidden animate-fade-in"><div class="absolute inset-0 pointer-events-none"><div class="absolute inset-0 bg-gradient-to-br from-slate-50 via-white to-blue-50/30"></div><div class="absolute inset-0 opacity-[0.02]"style="background-image:radial-gradient(circle at 2px 2px, rgb(var(--color-neutral-400)) 1px, transparent 0);background-size:40px 40px"></div><div class="absolute top-0 left-1/4 w-96 h-96 bg-blue-400/[0.05] rounded-full blur-3xl animate-pulse-subtle"></div><div class="absolute bottom-0 right-1/4 w-80 h-80 bg-purple-400/[0.05] rounded-full blur-3xl animate-pulse-subtle"style=animation-delay:1s></div><div class="absolute inset-0 opacity-[0.015] bg-gradient-to-tr from-transparent via-neutral-500/10 to-transparent"></div></div><main class="flex-1 relative"style="height:calc(100vh - 65px)"><div class="relative w-full h-full"style=height:100%><div class="absolute inset-0 w-full h-full"style=height:100%></div><div class="absolute inset-0 pointer-events-none"><div class=pointer-events-auto></div><div class="lg:hidden fixed bottom-6 right-6 z-40 pointer-events-auto"><button class="w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full shadow-xl flex items-center justify-center text-white animate-scale-in"><svg class="w-6 h-6"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg></button></div></div></div><div class="fixed inset-0 pointer-events-none z-50"></div></main><div class="lg:hidden fixed bottom-0 left-0 right-0 bg-glass border-t border-neutral-200/50 p-4 z-30"><div class="flex items-center justify-between"><div class="flex items-center space-x-3"><div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse-subtle"></div><span class="text-body-sm text-primary font-medium">系統運行中</span></div><div class="flex items-center space-x-2"><button class="btn-ghost btn-icon"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"></path></svg></button><button class="btn-primary btn-icon"><svg class="w-5 h-5"fill=none stroke=currentColor viewBox="0 0 24 24"><path stroke-linecap=round stroke-linejoin=round stroke-width=1.5 d="M7.5 8.25h9m-9 3H12m-9.75 1.51c0 1.6 1.123 2.994 2.707 3.227 1.129.166 2.27.293 3.423.379.35.026.67.21.865.501L12 21l2.755-4.133a1.14 1.14 0 01.865-.501 48.172 48.172 0 003.423-.379c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z">');const bi=()=>{const[e,t]=lt({isVoicePanelOpen:!1,isChatPanelOpen:!1,isGamePanelExpanded:!0,isSiteInfoPanelOpen:!1,isLoading:!0,currentHistoricalSite:void 0}),[i]=L(c());Ke(async()=>{try{await Ee.initializeGame(i()),t("isLoading",!1),console.log("🚀 Intelligent Spatial Platform initialized successfully")}catch(f){console.error("Failed to initialize application:",f),t("isLoading",!1)}});const s=()=>{t("isVoicePanelOpen",!e.isVoicePanelOpen)},l=()=>{t("isChatPanelOpen",!e.isChatPanelOpen)},n=()=>{t("isGamePanelExpanded",!e.isGamePanelExpanded)},a=f=>{t("currentHistoricalSite",f),t("isSiteInfoPanelOpen",!0)},r=()=>{t("isSiteInfoPanelOpen",!1),t("currentHistoricalSite",void 0)},d=(f,o)=>{Ee.updatePlayerPosition(f,o)};function c(){return"user_"+Math.random().toString(36).substring(2)+Date.now().toString(36)}return(()=>{var f=vi(),o=f.firstChild,m=o.nextSibling,g=m.firstChild,p=g.firstChild,v=p.nextSibling,S=v.firstChild,x=S.nextSibling,w=x.firstChild,y=g.nextSibling,_=m.nextSibling,h=_.firstChild,k=h.firstChild,M=k.nextSibling,J=M.firstChild,F=J.nextSibling;return u(f,C(Bt,{onToggleVoice:s,onToggleChat:l}),m),u(p,C(Rt,{onPlayerMove:d,onHistoricalSiteClick:a})),u(S,C(Yt,{get isExpanded(){return e.isGamePanelExpanded},onToggle:n})),w.$$click=n,u(y,C(H,{get when(){return e.isChatPanelOpen},get children(){var P=Pe();return u(P,C(si,{onClose:()=>t("isChatPanelOpen",!1)})),P}}),null),u(y,C(H,{get when(){return e.isVoicePanelOpen},get children(){var P=Pe();return u(P,C(oi,{onClose:()=>t("isVoicePanelOpen",!1)})),P}}),null),u(y,C(H,{get when(){return ie(()=>!!e.isSiteInfoPanelOpen)()&&e.currentHistoricalSite},get children(){var P=Pe();return u(P,C(gi,{get site(){return e.currentHistoricalSite},onClose:r})),P}}),null),u(f,C(H,{get when(){return e.isLoading},get children(){var P=pi();return u(P,C(mi,{message:"載入智能空間平台..."})),P}}),_),J.$$click=s,F.$$click=l,f})()};le(["click"]);const xi=document.getElementById("root");kt(()=>C(bi,{}),xi);
//# sourceMappingURL=index-sDbxcFP4.js.map
