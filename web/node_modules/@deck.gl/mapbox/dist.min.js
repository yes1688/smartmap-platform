(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var it=Object.create;var S=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var at=Object.getOwnPropertyNames;var ct=Object.getPrototypeOf,lt=Object.prototype.hasOwnProperty;var ut=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),pt=(e,t)=>{for(var o in t)S(e,o,{get:t[o],enumerable:!0})},j=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of at(t))!lt.call(e,r)&&r!==o&&S(e,r,{get:()=>t[r],enumerable:!(n=st(t,r))||n.enumerable});return e},d=(e,t,o)=>(j(e,t,"default"),o&&j(o,t,"default")),b=(e,t,o)=>(o=e!=null?it(ct(e)):{},j(t||!e||!e.__esModule?S(o,"default",{value:e,enumerable:!0}):o,e)),dt=e=>j(S({},"__esModule",{value:!0}),e);var f=ut((Ot,Y)=>{Y.exports=globalThis.deck});var E={};pt(E,{MapboxOverlay:()=>P});var p={},B=b(f(),1);d(p,b(f(),1));if(!B.Layer)throw new Error("@deck.gl/core is not found");d(E,p);var M=b(f(),1);var h=b(f(),1);function I(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var m=Math.PI,Mt=m/4,R=m/180,Nt=180/m,z=512,gt=4003e4;function v(e){let[t,o]=e;I(Number.isFinite(t)),I(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude");let n=t*R,r=o*R,a=z*(n+m)/(2*m),i=z*(m+Math.log(Math.tan(Mt+r*.5)))/(2*m);return[a,i]}function V(e){let t=Math.cos(e*R);return z/gt/t}var qt=Math.PI/180;var A=512,jt=Math.PI/180;function C({map:e,gl:t,deck:o}){if(e.__deck)return e.__deck;let n=o?.props._customRender,r=o?.props.onLoad,a={...o?.props,_customRender:()=>{e.triggerRepaint(),n?.("")}};a.parameters={...F(e,!0),...a.parameters},a.views||=w(e);let i;return(!o||o.props.gl===t)&&(Object.assign(a,{gl:t,width:null,height:null,touchAction:"unset",viewState:x(e)}),o?.isInitialized?q(o,e):a.onLoad=()=>{r?.(),q(i,e)}),o?(i=o,o.setProps(a),o.userData.isExternal=!0):(i=new h.Deck(a),e.on("remove",()=>{Z(e)})),i.userData.mapboxLayers=new Set,e.__deck=i,e.on("render",()=>{i.isInitialized&&It(i,e)}),i}function q(e,t){let o=()=>{e.isInitialized?Ct(e,t):t.off("move",o)};t.on("move",o)}function Z(e){e.__deck?.finalize(),e.__deck=null}function F(e,t){let o=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return tt(e)==="globe"&&(o.cullMode="back"),o}function $(e,t){e.userData.mapboxLayers.add(t),N(e)}function J(e,t){e.userData.mapboxLayers.delete(t),N(e)}function K(e,t){N(e)}function Q(e,t,o,n){let{currentViewport:r}=e.userData,a=!1;r||(r=et(e,t,n),e.userData.currentViewport=r,a=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[r],layerFilter:i=>(!e.props.layerFilter||e.props.layerFilter(i))&&(o.id===i.layer.id||i.layer.props.operation.includes("terrain")),clearStack:a,clearCanvas:!1})}function tt(e){let t=e.getProjection?.(),o=t?.type||t?.name;if(o==="globe")return"globe";if(o&&o!=="mercator")throw new Error("Unsupported projection");return"mercator"}function w(e){return tt(e)==="globe"?new h._GlobeView({id:"mapbox"}):new h.MapView({id:"mapbox"})}function x(e){let{lng:t,lat:o}=e.getCenter(),n={longitude:(t+540)%360-180,latitude:o,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&St(e,n),n}function St(e,t){if(e.getFreeCameraOptions){let{position:o}=e.getFreeCameraOptions();if(!o||o.z===void 0)return;let n=e.transform.height,{longitude:r,latitude:a,pitch:i}=t,s=o.x*A,c=(1-o.y)*A,l=o.z*A,u=v([r,a]),g=s-u[0],y=c-u[1],k=Math.sqrt(g*g+y*y),T=i*jt,O=1.5*n,G=T<.001?O*Math.cos(T)/l:O*Math.sin(T)/k;t.zoom=Math.log2(G);let nt=O*Math.cos(T)/G,rt=l-nt;t.position=[0,0,rt/V(a)]}else typeof e.transform.elevation=="number"&&(t.position=[0,0,e.transform.elevation])}function et(e,t,o){let n=x(t),r=w(t);o&&(r.props.nearZMultiplier=.2);let a=o?.nearZ??t.transform._nearZ,i=o?.farZ??t.transform._farZ;return Number.isFinite(a)&&(n.nearZ=a/t.transform.height,n.farZ=i/t.transform.height),r.makeViewport({width:e.width,height:e.height,viewState:n})}function It(e,t){let{mapboxLayers:o,isExternal:n}=e.userData;if(n){let r=Array.from(o,u=>u.id),i=(0,h._flatten)(e.props.layers,Boolean).some(u=>u&&!r.includes(u.id)),s=e.getViewports(),c=s.findIndex(u=>u.id==="mapbox"),l=s.length>1||c<0;(i||l)&&(c>=0&&(s=s.slice(),s[c]=et(e,t)),e._drawLayers("mapbox-repaint",{viewports:s,layerFilter:u=>(!e.props.layerFilter||e.props.layerFilter(u))&&(u.viewport.id!=="mapbox"||!r.includes(u.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function Ct(e,t){e.setProps({viewState:x(t)}),e.needsRedraw({clearRedrawFlags:!0})}function N(e){if(e.userData.isExternal)return;let t=[];e.userData.mapboxLayers.forEach(o=>{let n=o.props.type,r=new n(o.props);t.push(r)}),e.setProps({layers:t})}var ot=b(f(),1);var X=b(f(),1);var L=class{constructor(t){if(!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.slot=t.slot,this.map=null,this.deck=null,this.props=t}onAdd(t,o){this.map=t,this.deck=C({map:t,gl:o,deck:this.props.deck}),$(this.deck,this)}onRemove(){this.deck&&J(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&K(this.deck,this)}render(t,o){Q(this.deck,this.map,this,o)}};var U="__UNDEFINED__";function D(e,t,o,n){if(!e||!t||!e.style||!e.style._loaded)return;let r=(0,X._flatten)(n,Boolean);if(o!==n){let s=(0,X._flatten)(o,Boolean),c=new Set(s.map(l=>l.id));for(let l of r)c.delete(l.id);for(let l of c)e.getLayer(l)&&e.removeLayer(l)}for(let s of r){let c=e.getLayer(s.id);c?(c.implementation||c).setProps(s.props):e.addLayer(new L({id:s.id,deck:t,slot:s.props.slot}),s.props.beforeId)}let a=e.style._order,i={};for(let s of r){let{beforeId:c}=s.props;(!c||!a.includes(c))&&(c=U),i[c]=i[c]||[],i[c].push(s.id)}for(let s in i){let c=i[s],l=s===U?a.length:a.indexOf(s),u=s===U?void 0:s;for(let g=c.length-1;g>=0;g--){let y=c[g],k=a.indexOf(y);k!==l-1&&(e.moveLayer(y,u),k>l&&l++),l--,u=y}}}var P=class{constructor(t){this._handleStyleChange=()=>{D(this._map,this._deck,this._props.layers,this._props.layers)};this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:t,clientHeight:o}=this._map.getContainer();Object.assign(this._container.style,{width:`${t}px`,height:`${o}px`})}};this._updateViewState=()=>{let t=this._deck,o=this._map;t&&o&&(t.setProps({views:this._props.views||w(o),viewState:x(o)}),t.isInitialized&&t.redraw())};this._handleMouseEvent=t=>{let o=this._deck;if(!o||!o.isInitialized)return;let n={type:t.type,offsetCenter:t.point,srcEvent:t},r=this._lastMouseDownPoint;switch(!t.point&&r&&(n.deltaX=t.originalEvent.clientX-r.clientX,n.deltaY=t.originalEvent.clientY-r.clientY,n.offsetCenter={x:r.x+n.deltaX,y:r.y+n.deltaY}),n.type){case"mousedown":o._onPointerDown(n),this._lastMouseDownPoint={...t.point,clientX:t.originalEvent.clientX,clientY:t.originalEvent.clientY};break;case"dragstart":n.type="panstart",o._onEvent(n);break;case"drag":n.type="panmove",o._onEvent(n);break;case"dragend":n.type="panend",o._onEvent(n);break;case"click":n.tapCount=1,o._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,o._onEvent(n);break;case"mousemove":n.type="pointermove",o._onPointerMove(n);break;case"mouseout":n.type="pointerleave",o._onPointerMove(n);break;default:return}};let{interleaved:o=!1,...n}=t;this._interleaved=o,this._props=n}setProps(t){this._interleaved&&t.layers&&D(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...F(this._map,this._interleaved),...this._props.parameters}})}onAdd(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}_onAddOverlaid(t){let o=document.createElement("div");return Object.assign(o.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=o,this._deck=new M.Deck({...this._props,parent:o,parameters:{...F(t,!1),...this._props.parameters},views:this._props.views||w(t),viewState:x(t)}),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),o}_onAddInterleaved(t){let o=t.painter.context.gl;return o instanceof WebGLRenderingContext&&ot.log.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=C({map:t,gl:o,deck:new M.Deck({...this._props,gl:o})}),t.on("styledata",this._handleStyleChange),D(t,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(t){t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(t){t.off("styledata",this._handleStyleChange),D(t,this._deck,this._props.layers,[]),Z(t)}getDefaultPosition(){return"top-left"}pickObject(t){return(0,M.assert)(this._deck),this._deck.pickObject(t)}pickMultipleObjects(t){return(0,M.assert)(this._deck),this._deck.pickMultipleObjects(t)}pickObjects(t){return(0,M.assert)(this._deck),this._deck.pickObjects(t)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};return dt(E);})();
      return __exports__;
      });
